name: Update Site Configuration

on:
  workflow_dispatch:
    inputs:
      site_title:
        description: 'ç½‘ç«™æ ‡é¢˜'
        required: true
        default: '68-å®‰å…¨åŠ å¯†å³æ™‚èŠå¤©å·¥å…·'
      site_description:
        description: 'ç½‘ç«™æè¿°'
        required: true
        default: '68æ˜¯ä¸€æ¬¾æ³¨é‡å®‰å…¨å’Œéš±ç§çš„å³æ™‚é€šè¨Šè»Ÿé«”'
      android_url:
        description: 'Androidä¸‹è½½é“¾æ¥'
        required: true
        default: 'https://example.com/android-download'
      ios_url:
        description: 'iOSä¸‹è½½é“¾æ¥'
        required: true
        default: 'https://example.com/ios-download'
      contact_email:
        description: 'è”ç³»é‚®ç®±'
        required: true
        default: 'admin@68service.net'

permissions:
  contents: write

jobs:
  update-config:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Update configuration
        run: |
          # è¯»å–ç°æœ‰é…ç½®
          CONFIG_FILE="data.json"
          
          # ä½¿ç”¨ jq æ›´æ–°é…ç½®
          sudo apt-get update && sudo apt-get install -y jq
          
          # æ›´æ–°é…ç½®æ•°æ®
          jq --arg title "${{ github.event.inputs.site_title }}" \
             --arg desc "${{ github.event.inputs.site_description }}" \
             --arg android "${{ github.event.inputs.android_url }}" \
             --arg ios "${{ github.event.inputs.ios_url }}" \
             --arg email "${{ github.event.inputs.contact_email }}" \
             --arg date "$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)" \
             '.site.title = $title | 
              .site.description = $desc | 
              .downloads.android.url = $android | 
              .downloads.ios.url = $ios | 
              .contact.email = $email | 
              .lastModified = $date' \
             $CONFIG_FILE > temp.json && mv temp.json $CONFIG_FILE

      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data.json
          git commit -m "ğŸ”§ æ›´æ–°ç½‘ç«™é…ç½®

          - æ ‡é¢˜: ${{ github.event.inputs.site_title }}
          - æè¿°: ${{ github.event.inputs.site_description }}
          - Android: ${{ github.event.inputs.android_url }}
          - iOS: ${{ github.event.inputs.ios_url }}
          - é‚®ç®±: ${{ github.event.inputs.contact_email }}
          
          æ›´æ–°æ—¶é—´: $(date -u +%Y-%m-%d\ %H:%M:%S\ UTC)
          æ“ä½œè€…: ${{ github.actor }}"
          
          git push

      - name: Create release
        if: success()
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: config-update-${{ github.run_number }}
          release_name: é…ç½®æ›´æ–° ${{ github.run_number }}
          body: |
            ## ğŸ”§ é…ç½®æ›´æ–°è¯¦æƒ…
            
            **æ›´æ–°æ—¶é—´**: $(date -u +%Y-%m-%d\ %H:%M:%S\ UTC)
            **æ“ä½œè€…**: ${{ github.actor }}
            
            ### æ›´æ–°å†…å®¹
            - **ç½‘ç«™æ ‡é¢˜**: ${{ github.event.inputs.site_title }}
            - **ç½‘ç«™æè¿°**: ${{ github.event.inputs.site_description }}
            - **Androidä¸‹è½½**: ${{ github.event.inputs.android_url }}
            - **iOSä¸‹è½½**: ${{ github.event.inputs.ios_url }}
            - **è”ç³»é‚®ç®±**: ${{ github.event.inputs.contact_email }}
            
            ### éƒ¨ç½²çŠ¶æ€
            å‰ç«¯é¡µé¢å°†åœ¨å‡ åˆ†é’Ÿå†…è‡ªåŠ¨æ›´æ–°ã€‚
          draft: false
          prerelease: false
